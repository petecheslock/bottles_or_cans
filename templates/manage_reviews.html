{% extends 'base.html' %}

{% block content %}
<div class="container mx-auto px-4 mt-12">
   <div class="flex justify-between items-center mb-8">
       <h1 class="text-3xl font-bold">Manage Reviews</h1>
       <form action="{{ url_for('reset_votes') }}" 
             method="POST" 
             onsubmit="return confirm('Are you sure you want to reset ALL vote counts to zero? This action cannot be undone.');">
           <button type="submit" class="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:-translate-y-0.5 transition-all duration-300">
               <i class="bi bi-arrow-counterclockwise mr-2"></i>Reset All Vote Counts
           </button>
       </form>
   </div>
   
   {% with messages = get_flashed_messages(with_categories=true) %}
       {% if messages %}
           {% for category, message in messages %}
               <div class="p-4 mb-4 rounded-lg {% if category == 'success' %}bg-green-100 text-green-700{% elif category == 'danger' %}bg-red-100 text-red-700{% else %}bg-blue-100 text-blue-700{% endif %} flex justify-between items-center">
                   {{ message }}
                   <button type="button" class="text-lg font-semibold" onclick="this.parentElement.remove()">Ã—</button>
               </div>
           {% endfor %}
       {% endif %}
   {% endwith %}
   
   <div class="overflow-x-auto">
       <table class="w-full bg-white rounded-lg shadow-md">
           <thead class="bg-gray-50">
               <tr>
                   <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                   <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Review Text</th>
                   <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Headphone Votes</th>
                   <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Wine Votes</th>
                   <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Created</th>
                   <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
               </tr>
           </thead>
           <tbody class="divide-y divide-gray-200">
               {% for review in reviews %}
               <tr class="hover:bg-gray-50">
                   <td class="px-6 py-4 whitespace-nowrap">{{ review.id }}</td>
                   <td class="px-6 py-4">{{ review.text }}</td>
                   <td class="px-6 py-4">{{ review.votes_headphones }}</td>
                   <td class="px-6 py-4">{{ review.votes_wine }}</td>
                   <td class="px-6 py-4 whitespace-nowrap">{{ review.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                   <td class="px-6 py-4 whitespace-nowrap">
                       <div class="flex space-x-2">
                           <a href="{{ url_for('edit_review', review_id=review.id) }}" 
                              class="px-3 py-1 bg-yellow-500 text-white rounded hover:-translate-y-0.5 transition-all duration-300">Edit</a>
                           <form action="{{ url_for('delete_review', review_id=review.id) }}" 
                                 method="POST"
                                 class="inline"
                                 onsubmit="return confirm('Are you sure you want to delete this review?');">
                               <button type="submit" class="px-3 py-1 bg-red-500 text-white rounded hover:-translate-y-0.5 transition-all duration-300">Delete</button>
                           </form>
                       </div>
                   </td>
               </tr>
               {% endfor %}
           </tbody>
       </table>
   </div>
</div>
{% endblock %}