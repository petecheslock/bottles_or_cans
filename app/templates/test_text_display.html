{% extends 'base.html' %}

{% block content %}
<div class="container mx-auto px-4 mt-12">
    <div class="max-w-2xl mx-auto space-y-8">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
            <h1 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">Text Display Test</h1>
            <p class="text-gray-600 dark:text-gray-400 mb-4">Testing container sizing with actual reviews from the database.</p>
        </div>

        {% for review in reviews %}
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md animate__animated animate__fadeIn">
            <div class="border-b border-gray-200 dark:border-gray-700 p-4">
                <h2 class="text-lg font-semibold text-gray-900 dark:text-white">
                    Review #{{ review.id }}
                </h2>
            </div>
            
            <!-- Review Text Section - Match game width exactly -->
            <div class="p-8 border-b border-gray-200 dark:border-gray-700">
                <div class="text-container text-xl italic text-gray-800 dark:text-gray-200 p-4 mb-2 bg-gray-50 dark:bg-gray-700 rounded-lg relative">
                    <div id="measureText{{ loop.index }}" class="font-mono whitespace-pre-wrap leading-relaxed invisible absolute top-0 left-0 right-0 pt-4 px-4">{{ review.text }}</div>
                    <p id="reviewText{{ loop.index }}" class="font-mono whitespace-pre-wrap leading-relaxed -mb-1">{{ review.text }}</p>
                </div>
            </div>
            
            <!-- Debug Info -->
            <div class="p-4 bg-gray-50 dark:bg-gray-900 text-sm">
                <p class="text-gray-600 dark:text-gray-400">
                    Character count: {{ review.text|length }}
                </p>
                <p class="text-gray-600 dark:text-gray-400">
                    Line count: <span id="lineCount{{ loop.index }}">Calculating...</span>
                </p>
                <p class="text-gray-600 dark:text-gray-400">
                    Container height: <span id="containerHeight{{ loop.index }}">Measuring...</span>
                </p>
                <p class="text-gray-600 dark:text-gray-400">
                    Votes: üéß {{ review.votes_headphones }} | üç∑ {{ review.votes_wine }}
                </p>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    {% for review in reviews %}
        initializeContainer({{ loop.index }});
    {% endfor %}
});

function initializeContainer(index) {
    const measureDiv = document.getElementById(`measureText${index}`);
    const textContainer = document.getElementById(`reviewText${index}`);
    
    // Force a layout calculation
    void measureDiv.offsetHeight;
    
    // Set both min-height and height to ensure proper sizing
    const measuredHeight = measureDiv.offsetHeight;
    textContainer.style.minHeight = measuredHeight + 'px';
    textContainer.style.height = measuredHeight + 'px';
    
    // Update debug info
    document.getElementById(`lineCount${index}`).textContent = 
        Math.round(measuredHeight / parseInt(getComputedStyle(measureDiv).lineHeight));
    document.getElementById(`containerHeight${index}`).textContent = 
        `${measuredHeight}px`;
    
    // Remove the measurement div since we don't need it anymore
    measureDiv.remove();
}
</script>
{% endblock %} 